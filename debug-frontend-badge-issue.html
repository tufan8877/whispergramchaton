<!DOCTYPE html>
<html>
<head>
    <title>Badge Debug Test</title>
</head>
<body>
    <h1>Frontend Badge Debug</h1>
    <div id="results"></div>
    
    <script>
        async function debugBadgeIssue() {
            const results = document.getElementById('results');
            
            try {
                // 1. Test Backend API direkt
                console.log('ğŸ§ª Testing Backend API directly...');
                const response = await fetch('/api/chats/7');
                const data = await response.json();
                
                console.log('ğŸ“Š Backend Response:', data);
                results.innerHTML += `<p><strong>Backend API:</strong> ${JSON.stringify(data, null, 2)}</p>`;
                
                if (data && data.length > 0) {
                    const chat = data[0];
                    const unreadCount = chat.unreadCount2 || 0;
                    
                    results.innerHTML += `<p><strong>Backend unreadCount2:</strong> ${unreadCount}</p>`;
                    console.log(`ğŸ”¥ Backend zeigt unreadCount2: ${unreadCount}`);
                    
                    if (unreadCount > 1) {
                        results.innerHTML += `<p style="color: green;">âœ… Backend zÃ¤hlt korrekt (${unreadCount} > 1)</p>`;
                    } else {
                        results.innerHTML += `<p style="color: red;">âŒ Backend zÃ¤hlt nicht (${unreadCount})</p>`;
                    }
                } else {
                    results.innerHTML += `<p style="color: red;">âŒ Keine Chat-Daten gefunden</p>`;
                }
                
                // 2. PrÃ¼fe Frontend localStorage
                console.log('ğŸ§ª Checking Frontend localStorage...');
                const userSession = localStorage.getItem('userSession');
                if (userSession) {
                    const session = JSON.parse(userSession);
                    results.innerHTML += `<p><strong>Frontend User:</strong> ${session.username} (ID: ${session.id})</p>`;
                    console.log('ğŸ‘¤ Frontend User:', session);
                } else {
                    results.innerHTML += `<p style="color: red;">âŒ Kein User eingeloggt</p>`;
                }
                
                // 3. PrÃ¼fe React Dev Tools (simuliert)
                console.log('ğŸ§ª Simulating React State Check...');
                results.innerHTML += `<p><strong>React State Check:</strong> Ã–ffnen Sie die Browser Console fÃ¼r Details</p>`;
                
            } catch (error) {
                console.error('âŒ Debug Error:', error);
                results.innerHTML += `<p style="color: red;">âŒ Fehler: ${error.message}</p>`;
            }
        }
        
        // Sofort ausfÃ¼hren
        debugBadgeIssue();
        
        // Alle 5 Sekunden wiederholen
        setInterval(debugBadgeIssue, 5000);
    </script>
</body>
</html>